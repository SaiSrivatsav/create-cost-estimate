sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/ui/core/BusyIndicator","sap/ui/table/Column","sap/m/Label","sap/m/Text","sap/m/MessageToast","re/fin/createcostestimate/model/formatter"],(e,t,s,a,i,r,o,n,l,g,c,d)=>{"use strict";return e.extend("re.fin.createcostestimate.controller.Main",{formatter:d,onInit(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("RouteMain").attachPatternMatched(this.onRouteMatched,this)},onRouteMatched(e){var t={material:"MT-00001",materialName:"Material name text",plant:"3241",plantName:"Plant name text",costingFromDate:new Date,costingToDate:new Date};var a=new s(t);this.getView().setModel(a,"CreateModel");let i=new s;this.getView().setModel(i,"ProgressModel");this.getView().byId("refin-idRefresh").firePress()},async onRefresh(e){n.show();const t=this.getOwnerComponent().getManifestObject().resolveUri(this.getOwnerComponent().getManifestEntry("sap.app").dataSources.mainService.uri);try{const e=await fetch(t+"/CostEstimateLog?$expand=errorLogs");if(!e.ok){let t=await e.text()}else{const t=await e.json();this.cloudRecords=t.value;this.getView().getModel("Records").setData(this.cloudRecords);this.getView().getModel("Records").refresh()}let s=this.getView().byId("refin-idMainTable").getItems();for(let e=0;e<s.length;e++){const t=s[e];switch(t.getCells()[5].getText()){case"SUCCESS":t.getCells()[5].setIcon("sap-icon://verified");t.getCells()[5].setState("Success");t.getCells()[6].setVisible(true);break;case"COMPLETED":t.getCells()[5].setIcon("sap-icon://complete");t.getCells()[5].setState("Information");t.getCells()[6].setVisible(false);break;case"ERROR":t.getCells()[5].setIcon("sap-icon://status-error");t.getCells()[5].setState("Error");t.getCells()[6].setVisible(false);break;case"SUBMITTED":t.getCells()[5].setIcon("sap-icon://in-progress");t.getCells()[5].setState("Warning");t.getCells()[6].setVisible(false);break;case"CANCELLED":t.getCells()[5].setIcon("sap-icon://cancel");t.getCells()[5].setState("Indication02");t.getCells()[6].setVisible(false);break;default:break}}n.hide()}catch(e){n.hide()}},onItemNavigate(e){const t=e.getSource().getBindingContext("Records").sPath.split("/")[1];const s=this.getOwnerComponent().getModel("Records").getData()[t].ID;const a=this.oRouter;a.navTo("RouteErrorDetail",{parentId:s})},onCreateCostEstimate(e){var t=this.getView();if(this.oCreateDialog){this.oCreateDialog=undefined}if(!this.oCreateDialog){this.oCreateDialog=a.load({id:t.getId(),controller:this,name:"re.fin.createcostestimate.view.fragments.CreateDialog"}).then(e=>{t.addDependent(e);return e})}this.oCreateDialog.then(function(e){e.open()})},async onSubmit(e){let t=this.submitPreChecks();if(t){let e=[{executionId:"CREATE-COST-EST",executionCompleted:false,active:false,operation:"Creating Cost Estimate",operationStatus:"Processing"},{executionId:"CLOUD-INSERT-NEW",executionCompleted:false,active:false,operation:"Updating data to cloud",operationStatus:"Pending"}];this.getView().getModel("ProgressModel").setData(e);this.getView().getDependents()[0].destroy();this.showProgressDialog();try{const t=await this.createCostEstimate();e[0].executionCompleted=true;e[0].operationStatus="DONE";e[0].active=false;e[1].operationStatus="Processing";e[1].active=true;this.getView().getModel("ProgressModel").setData(e);this.getView().getModel("ProgressModel").refresh();this.setProgressTabProps();const s="CREATE";const a=await this.activateCloudOperation(s);if(a.ID){const t=a.ID;const i=await this.activateErrorLogOperation(s,t);const r=await Promise.all(i);e[1].executionCompleted=true;e[1].operationStatus="DONE";e[1].active=false;this.getView().getModel("ProgressModel").setData(e);this.getView().getModel("ProgressModel").refresh()}this.setProgressTabProps();this.getView().byId("refin-idCloseProgress").setVisible(true);this.getView().byId("refin-idRefresh").firePress()}catch(e){}}},activateErrorLogOperation(e,t){let s=[{referenceId:"0001",parentId:t,errorId:"E101",description:"Error test",message:"Error Message Test",assignedDepartment:"MDM",assignedOn:new Date,departmentMail:"mdm@re.com",resolutionStatus:"Pending"},{referenceId:"0002",parentId:t,errorId:"E102",description:"Error test 2",message:"Error Message Test 2",assignedDepartment:"MM",assignedOn:new Date,departmentMail:"mm@re.com",resolutionStatus:"Pending"}];const a=this.getOwnerComponent().getManifestObject().resolveUri(this.getOwnerComponent().getManifestEntry("sap.app").dataSources.mainService.uri);let i=[];for(let e=0;e<s.length;e++){const t=s[e];let r=new Promise(function(t,i){$.ajax(a+"/ErrorLogs",{type:"POST",contentType:"application/json",data:JSON.stringify(s[e]),success:e=>{t(e)},error:e=>{i(e)}})});i.push(r)}return i},setProgressTabProps(){let e=this.getView().getModel("ProgressModel").getData();const t=this.getView().byId("refin-idProgressTable").getItems();for(let s=0;s<t.length;s++){let a=t[s];if(e[s].executionCompleted){a.getCells()[1].removeStyleClass("mySpinningIcon");a.getCells()[1].setIcon("");a.getCells()[1].setState("Success")}else{if(e[s].active){a.getCells()[1].setIcon("sap-icon://synchronize");a.getCells()[1].addStyleClass("mySpinningIcon");a.getCells()[1].setState("Warning")}else{a.getCells()[1].setIcon("");a.getCells()[1].setState("None")}}}},activateCloudOperation(e){let t={referenceId:"4238718",material:this.getView().getModel("CreateModel").getData().material,materialName:"Material name text",plant:this.getView().getModel("CreateModel").getData().plant,plantName:"Plant name text",costingFromDate:this.getView().getModel("CreateModel").costingFromDate,costingToDate:this.getView().getModel("CreateModel").costingToDate,status:"ERROR",systemStatus:"SUCCESS",noOfErrors:2};const s=this.getOwnerComponent().getManifestObject().resolveUri(this.getOwnerComponent().getManifestEntry("sap.app").dataSources.mainService.uri);return new Promise(function(e,a){$.ajax(s+"/CostEstimateLog",{type:"POST",contentType:"application/json",data:JSON.stringify(t),success:t=>{e(t)},error:e=>{a(e)}})})},async createCostEstimate(e){return new Promise(e=>setTimeout(e,3e3))},submitPreChecks(){let e=this.checkMandatoryFields();let t=this.validateInputCheck();if(!e&&!t){return true}else{return false}},onProgressDialogClose(e){e.getSource().getParent().getParent().destroy()},showProgressDialog(){var e=this.getView();if(this.oProgressDialog){this.oProgressDialog=undefined}if(!this.oProgressDialog){this.oProgressDialog=a.load({id:e.getId(),controller:this,name:"re.fin.createcostestimate.view.fragments.ProgressDialog"}).then(t=>{e.addDependent(t);return t})}this.oProgressDialog.then(function(e){const t=e.getAggregation("content")[0].getItems();e.getAggregation("content")[0].removeSelections(true);for(let e=0;e<t.length;e++){let s=t[e];if(e===0){s.getCells()[1].addStyleClass("mySpinningIcon");s.getCells()[1].setIcon("sap-icon://synchronize");s.getCells()[1].setState("Warning")}else{s.getCells()[1].setIcon("");s.getCells()[1].setState("None")}}e.open()})},validateInputCheck(){let e=false;return e},checkMandatoryFields(){let e=false;if(!this.getView().byId("refin-idCreateMaterial").getValue()){this.getView().byId("refin-idCreateMaterial").setValueState("Error");this.getView().byId("refin-idCreateMaterial").setValueStateText("Material is required");e=true}else{this.getView().byId("refin-idCreateMaterial").setValueState("None");this.getView().byId("refin-idCreateMaterial").setValueStateText("");e=false}if(!this.getView().byId("refin-idCreatePlant").getValue()){this.getView().byId("refin-idCreatePlant").setValueState("Error");this.getView().byId("refin-idCreatePlant").setValueStateText("Plant is required");e=true}else{this.getView().byId("refin-idCreatePlant").setValueState("None");this.getView().byId("refin-idCreatePlant").setValueStateText("");e=false}return e},onCancelDialog(e){e.getSource().getParent().getParent().destroy()}})});
//# sourceMappingURL=Main.controller.js.map